<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
		<title>购物车</title>
		
		<link type="text/css" rel="stylesheet" href="css/common.css"/>
		<style>
			table{width:968px;height:auto;margin:0 auto;border-spacing:0px;border:0.5px solid white;}
			thead tr{width:100%;height:42px;background-color:#ececec;}
			table th {text-align:left;line-height:42px;}
			table th :first-child{width:70px;}
			table th :nth-child(2){width:360px;}
			table th :nth-child(3){width:102px;}
			table th :nth-child(4){width:100px;}
			table th :nth-child(5){width:126px;}
			table th :nth-child(6){width:126px;}
			table th :nth-child(7){width:90px;}
			#choose {width:10px;height:10px;}
			tbody{border:1px solid white;}
			tbody tr{background-color:#fdf0ef;width:100%;}
			tbody tr td:nth-child(5) span:nth-child(odd){background-color:white;display:inline-block;width:12px;line-height:18px;text-align:center;border:0.5px solid #ececec;}
			tbody tr td:nth-child(5) span:nth-child(even){background-color:white;display:inline-block;width:36px;line-height:18px;text-align:center;border:0.5px solid #ececec;}
			#cal{width:893px;height:167px;padding:15px 45px 25px 30px;margin:0 auto;margin-top:5px;border:1px solid #f1f1f1;
				background-color:#fff;
			}
			#cal p{text-align:right;}
			#cal p:first-child{width:910px;height:23px;}
			#cal p:first-child span:first-child{margin-right:700px;}
			#cal p:nth-child(2){width:910px;height:23px;}
			#cal p:nth-child(3){width:910px;height:23px;}
			#cal p:nth-child(4){width:910px;height:44px;}
			#cal p:nth-child(4) strong{font-size:30px;color:#e93b39;font-weight:blod;line-height:44px;}
			#cal p:nth-child(5){width:910px;height:48px;padding:2px 0px;}
			#cal p:nth-child(5) span:first-child{border:1px solid #d32220;color:#d32220;opacity:0.7;float:left;width:78px;height:36px;line-height:36px;text-align:center;}
			#cal p:nth-child(5) span:nth-child(2){width:136px;height:38px;font-weight:blod;background-color:#d32220;opacity:0.7;color:#fff;line-height:38px;text-align:center;float:right;}
			
		</style>
		<script>
			window.onload=function(){
			/*设置cookie的对象*/
			var cookieUtil={
				get:function(name){
					var cookieName=encodeURIComponent(name)+"=";
					var cookieStart=document.cookie.indexOf(cookieName);
					var cookieValue=null;
					if(cookieStart>-1){
						var cookieEnd=document.cookie.indexOf(";",cookieStart);
						if(cookieEnd==-1){
							cookieEnd=document.cookie.length;
						}
						cookieValue=decodeURIComponent(document.cookie.substring(cookieStart+cookieName.length,cookieEnd));
						
					}
					return cookieValue;
				},
				set:function(name,value,expires,path,domain,secure){
					var cookieText=encodeURIComponent(name)+"="+encodeURIComponent(value);
					//console.log(cookieText)
					//var cookieText=name +"=" +value;
					if(expires instanceof Date){
						cookieText+=";expires="+expires.toGMTString();
					}
					if(path){
						cookieText+=";path="+path;
					}if(domain){
						cookieText+=";domain="+domain;
					}if(secure){
						cookieText+=";secure";
					}
					document.cookie=cookieText;
					//console.log(document.cookie);
				},
				unset:function(name,path,domain,secure){
					this.set(name,"",new Date(0),path,domain,secure);
				}
			};
			/*添加事件的对象*/
			var EventUtil={
			addEvent:function(element,type,hander){
				if(element.addEventListener){
					element.addEventListener(type,hander,false)
				}else if(element.attachEvent){
					element.attachEvent("on"+type,hander);
				}else{
					element["on"+type]=hander;
				}
			},
			removeEvent:function(element,type,hander){
				if(element.removeEventListener){
					element.removeEventListener(type,hander,false);
				}else if(element.detachEvent){
					element.detachEvent("on"+type,hander);
				}else{
					element["on"+type]=null;

				}
			}
		};
		addMessage(EventUtil,cookieUtil);
		calCash(EventUtil);
}
		function addMessage(EventUtil,cookieUtil){
		var _arr=decodeURIComponent(window.location.search.replace("?","")).split("&");/*从地址栏中获取产品购买信息*/
			var _name=_arr[0].split("=")[1];/*产品名称*/
			var _count=parseInt(_arr[1].split("=")[1]);/*产品购买数量*/
			var _tr=document.createElement("tr");
			
			
			var _total=parseInt(cookieUtil.get("count"));/*获取产品的总共数量*/
			var _source=cookieUtil.get("source");/*获取产品的地址信息*/
			var _level=cookieUtil.get("used");/*获取产品的等级*/
			document.getElementsByTagName("tbody")[0].appendChild(_tr);
			var _td=null;
			var _span=null;
			for(var i=0;i<7;i++){
				_td=document.createElement("td");
				_tr.appendChild(_td);
			}
			/*产品信息的添加*/
			var _tds=document.getElementsByTagName("td");
			_tds[1].style.height="82px";
			_tds[0].innerHTML=("<input type=\"checkbox\" checked/ style=\"width=\"10px\" height=\"10px\"\">"+"全选");
			/*复选框改变当前元素的北京颜色*/
			function changeColor(){
					if(_tds[0].children[0].checked){
					_tds[0].parentNode.style.backgroundColor="#fdf0ef";
					}else{
					_tds[0].parentNode.style.backgroundColor="white";
					}
			}
			_tds[0].children[0].onclick=changeColor;
			
			_tds[1].innerHTML=("<img alt=\"\" src=\"images/"+_source+".jpg"+"\"/>"+"<span>"+_name+"</span>");
			_tds[1].children[0].style.float="left";
			_tds[1].children[0].style.width="82px";
			_tds[1].children[0].style.margin="20px 15px 20px 0px";
			_tds[1].children[0].style.height="82px";
			_tds[1].children[1].style.lineHeight="56px";
			_tds[1].style.textAlign="left";
			_tds[2].innerHTML=cookieUtil.get("where");
			_tds[3].innerHTML=cookieUtil.get("price");
			_tds[4].innerHTML="<span>-</span>"+"<span>"+_count+"</span>"+"<span>+</span>";
			
			_tds[5].innerHTML=parseInt(cookieUtil.get("price"))*_count;
			_tds[6].innerHTML="删除";
			_tds[6].style.position="relative";
			EventUtil.addEvent(_tds[6],"click",function(){
				_span=document.createElement("span");
				_span.style.display="inline-block";
				_span.style.width="150px";
				_span.style.height="86px";
				_span.style.border="1px solid grey";
				_span.style.textAlign="center";
				_span.style.lineHeight=24+"px";
				_span.style.color="white";
				_span.style.zIndex=1;
				_span.style.position="absolute";
				_span.style.top="70px";
				_span.style.left=-50+"px";
				_span.innerHTML=("<span>您确定要删除吗?</span>"+"<span>确定</span>"+"<span>取消</span>");
				_span.children[0].style.display="block";
				_span.children[0].style.width="100%";
				_span.children[0].style.color="black";
				_span.children[0].style.lineHeight=42+"px";
				_span.children[1].style.display="block";
				_span.children[1].style.float="left";
				_span.children[1].style.width="44px";
				_span.children[1].style.marginLeft="26px";
				_span.children[1].style.marginRight="8px";
				_span.children[1].style.backgroundColor="#e93b39";
				EventUtil.addEvent(_span.children[1],"click",function(){
					document.getElementsByTagName("tbody")[0].removeChild(this.parentNode.parentNode.parentNode);
				});
				EventUtil.addEvent(_span.children[2],"click",function(e){
					e=e||window.event;
					e.stopProgation?e.stopProgation():e.cancelBubble=true;
					e.preventDefault?e.preventDefault():e.returnValue=false;
					console.log(this.parentNode);
					_span.style.display="none";
				})
				_span.children[2].style.display="block";
				_span.children[2].style.float="left";
				_span.children[2].style.width="44px";
				_span.children[2].style.backgroundColor="#999999";
				this.appendChild(_span);
			
			});
			EventUtil.addEvent(_tds[4].children[0],"click",function(){
				if(parseInt(_tds[4].children[1].innerHTML)>1){
					_tds[4].children[1].innerHTML=parseInt(_tds[4].children[1].innerHTML)-1;
					_tds[5].innerHTML=parseInt(cookieUtil.get("price"))*(parseInt(_tds[4].children[1].innerHTML)-1);
				}else{
					_tds[4].children[1].innerHTML=1;
					_tds[5].innerHTML=parseInt(cookieUtil.get("price"));
				}
				calCash(EventUtil);
			});
			EventUtil.addEvent(_tds[4].children[2],"click",function(){
				if(parseInt(_tds[4].children[1].innerHTML)<_total){
					_tds[4].children[1].innerHTML=parseInt(_tds[4].children[1].innerHTML)+1;
					_tds[5].innerHTML=parseInt(cookieUtil.get("price"))*(parseInt(_tds[4].children[1].innerHTML)-1);

				}else{
					_tds[4].children[1].innerHTML=_total;
					_tds[5].innerHTML=parseInt(cookieUtil.get("price"))*_total;
				}
				calCash(EventUtil);
				
			});
		
		
		}
			/*计算货品总值*/
		function calCash(EventUtil){
			var _cal=document.getElementById("cal");
			var _tbody=document.getElementsByTagName("tbody")[0];
			var _money=0;
			var _len=_tbody.children.length;
			for(var i=0;i<_len;i++){
				_money+=parseFloat(_tbody.children[i].children[5].innerHTML);
			}		
			_cal.children[3].children[1].innerHTML=_money.toFixed(2);
			EventUtil.addEvent(_cal.children[4],"mouseover",function(e){
				e=e||window.event;
				var _target=e.target||e.srcElement;
				switch(_target.id){
					case "first":
					_target.style.opacity=1;					
					break;
					case "second":
					_target.style.opacity=1;				
					break;
				}
				
			});
			EventUtil.addEvent(_cal.children[4],"mouseleave",function(e){
				e=e||window.event;
				var _target=e.target||e.srcElement;				
				_target.children[1].style.opacity=0.7;
				_target.children[0].style.opacity=0.7;
				
			});
			
		}	
			
		
		</script>
	</head>
	<body>
		<table  cellpadding="20px">
			<thead>
				<tr>
				<th><input type="checkbox" checked id="choose">全选</th>
				<th>商品名称</th>
				<th>发货站</th>
				<th>价格</th>
				<th>数量</th>
				<th>金额小计</th>
				<th>操作</th>
			</tr>
			</thead>
			<tbody>
				
			
			</tbody>
			<tfoot>
			
				
			</tfoot>
			
		</table>
		<div id="cal">
			<p><input type="checkbox" checked name="chooseall"/><label for="chooseall">全选</label><span><span><img alt="" src="images/pic02.png"/></span><span>删除选中的商品</span><span></span></span><span>商品总计:</span><span></span></p>
			<p>包装数量总计:<span></span></p>
			<p>返利库币:<span></span></p>
			<p><span>商品金额总计(不含税费):</span><strong></strong></p>
			<p><span id="first">继续购物</span><span id="second">立即结算</span></p>
			
		</div>
	
	</body>
</html>